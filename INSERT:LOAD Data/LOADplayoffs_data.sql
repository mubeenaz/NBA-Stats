-- Change active schema to NBA 
USE NBA;

-- Create table which holds data for all playoffs games 
DROP TABLE IF EXISTS Playoffs_Data;
CREATE TABLE IF NOT EXISTS Playoffs_Data (
	GAME_ID	INT,
	SEASON_ID	INT,
	TEAM_ID_HOME	INT,
	TEAM_ABBREVIATION_HOME	TEXT,
	TEAM_NAME_HOME	TEXT,
	GAME_DATE	DATE,
	MATCHUP_HOME	TEXT,
	WL_HOME	ENUM('W', 'L'),
	MIN_HOME	INT,
	FGM_HOME	REAL,
	FGA_HOME	REAL,
	FG_PCT_HOME	REAL,
	FG3M_HOME	INT,
	FG3A_HOME	INT,
	FG3_PCT_HOME	REAL,
	FTM_HOME	REAL,
	FTA_HOME	REAL,
	FT_PCT_HOME	REAL,
	OREB_HOME	INT,
	DREB_HOME	INT,
	REB_HOME	INT,
	AST_HOME	INT,
	STL_HOME	INT,
	BLK_HOME	INT,
	TOV_HOME	INT,
	PF_HOME	REAL,
	PTS_HOME	INT,
	PLUS_MINUS_HOME	INT,
	VIDEO_AVAILABLE_HOME	INT,
	TEAM_ID_AWAY	INT,
	TEAM_ABBREVIATION_AWAY	TEXT,
	TEAM_NAME_AWAY	TEXT,
	MATCHUP_AWAY	TEXT,
	WL_AWAY	ENUM('W', 'L'),
	MIN_AWAY	INT,
	FGM_AWAY	REAL,
	FGA_AWAY	REAL,
	FG_PCT_AWAY	REAL,
	FG3M_AWAY	INT,
	FG3A_AWAY	INT,
	FG3_PCT_AWAY	REAL,
	FTM_AWAY	REAL,
	FTA_AWAY	REAL,
	FT_PCT_AWAY	REAL,
	OREB_AWAY	INT,
	DREB_AWAY	INT,
	REB_AWAY	INT,
	AST_AWAY	INT,
	STL_AWAY	INT,
	BLK_AWAY	INT,
	TOV_AWAY	INT,
	PF_AWAY	REAL,
	PTS_AWAY	INT,
	PLUS_MINUS_AWAY	INT,
	VIDEO_AVAILABLE_AWAY	INT,
	GAME_SEQUENCE	INT,
	GAME_STATUS_ID	INT,
	GAME_STATUS_TEXT	TEXT,
	GAMECODE	TEXT,
	HOME_TEAM_ID	INT,
	VISITOR_TEAM_ID	INT,
	SEASON	INT,
	LIVE_PERIOD	REAL,
	LIVE_PC_TIME	TEXT,
	NATL_TV_BROADCASTER_ABBREVIATION	TEXT,
	LIVE_PERIOD_TIME_BCAST	TEXT,
	WH_STATUS	REAL,
	TEAM_CITY_HOME	TEXT,
	PTS_PAINT_HOME	INT,
	PTS_2ND_CHANCE_HOME	INT,
	PTS_FB_HOME	INT,
	LARGEST_LEAD_HOME	INT,
	LEAD_CHANGES_HOME	INT,
	TIMES_TIED_HOME	INT,
	TEAM_TURNOVERS_HOME	INT,
	TOTAL_TURNOVERS_HOME	INT,
	TEAM_REBOUNDS_HOME	INT,
	PTS_OFF_TO_HOME	INT,
	TEAM_CITY_AWAY	TEXT,
	PTS_PAINT_AWAY	INT,
	PTS_2ND_CHANCE_AWAY	INT,
	PTS_FB_AWAY	INT,
	LARGEST_LEAD_AWAY	INT,
	LEAD_CHANGES_AWAY	INT,
	TIMES_TIED_AWAY	INT,
	TEAM_TURNOVERS_AWAY	INT,
	TOTAL_TURNOVERS_AWAY	INT,
	TEAM_REBOUNDS_AWAY	INT,
	PTS_OFF_TO_AWAY	INT,
	LEAGUE_ID	TEXT,
	GAME_DATE_DAY	TEXT,
	ATTENDANCE	INT,
	GAME_TIME	TEXT,
	TEAM_CITY_NAME_HOME	TEXT,
	TEAM_NICKNAME_HOME	TEXT,
	TEAM_WINS_LOSSES_HOME	TEXT,
	PTS_QTR1_HOME	INT,
	PTS_QTR2_HOME	INT,
	PTS_QTR3_HOME	INT,
	PTS_QTR4_HOME	INT,
	PTS_OT1_HOME	INT,
	PTS_OT2_HOME	INT,
	PTS_OT3_HOME	INT,
	PTS_OT4_HOME	INT,
	PTS_OT5_HOME	INT,
	PTS_OT6_HOME	INT,
	PTS_OT7_HOME	INT,
	PTS_OT8_HOME	INT,
	PTS_OT9_HOME	INT,
	PTS_OT10_HOME	INT,
	PTS_HOME_y	REAL,
	TEAM_CITY_NAME_AWAY	TEXT,
	TEAM_NICKNAME_AWAY	TEXT,
	TEAM_WINS_LOSSES_AWAY	TEXT,
	PTS_QTR1_AWAY	INT,
	PTS_QTR2_AWAY	INT,
	PTS_QTR3_AWAY	INT,
	PTS_QTR4_AWAY	INT,
	PTS_OT1_AWAY	INT,
	PTS_OT2_AWAY	INT,
	PTS_OT3_AWAY	INT,
	PTS_OT4_AWAY	INT,
	PTS_OT5_AWAY	INT,
	PTS_OT6_AWAY	INT,
	PTS_OT7_AWAY	INT,
	PTS_OT8_AWAY	INT,
	PTS_OT9_AWAY	INT,
	PTS_OT10_AWAY	INT,
	LAST_GAME_ID	INT,
	LAST_GAME_DATE_EST	DATE,
	LAST_GAME_HOME_TEAM_ID	INT,
	LAST_GAME_HOME_TEAM_CITY	TEXT,
	LAST_GAME_HOME_TEAM_NAME	TEXT,
	LAST_GAME_HOME_TEAM_ABBREVIATION	TEXT,
	LAST_GAME_HOME_TEAM_POINTS	INT,
	LAST_GAME_VISITOR_TEAM_ID	INT,
	LAST_GAME_VISITOR_TEAM_CITY	TEXT,
	LAST_GAME_VISITOR_TEAM_NAME	TEXT,
	LAST_GAME_VISITOR_TEAM_CITY1	TEXT,
	LAST_GAME_VISITOR_TEAM_POINTS	INT,
	HOME_TEAM_WINS	REAL,
	HOME_TEAM_LOSSES	REAL,
	SERIES_LEADER	TEXT,
	VIDEO_AVAILABLE_FLAG	REAL,
	PT_AVAILABLE	REAL,
	PT_XYZ_AVAILABLE	REAL,
	HUSTLE_STATUS	REAL,
	HISTORICAL_STATUS	REAL
);

-- Confirm playoffs_data table structure 
DESC Playoffs_Data;

-- Check server-side permission for loading local data. If OFF, turn ON
-- **Client-side permission has already been set to ON in Workbench 
SHOW VARIABLES LIKE 'local_infile';
SET GLOBAL local_infile = 1;
SHOW VARIABLES LIKE 'local_infile';					-- Verify 

-- Change number of warnings displayed by server by setting max_error_count variable 
SHOW VARIABLES LIKE 'max_error%';					-- 1024
SET max_error_count = 65000;
SHOW VARIABLES LIKE 'max_error%';					-- Verify 


-- Use LOAD DATA LOCAL command to import data into Playoffs_Data table from input file
LOAD DATA LOCAL INFILE '/Users/mubeen/Documents/Projects/SQL/NBA Project/playoffs_dataED.csv' INTO TABLE Playoffs_Data
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\r\n'
IGNORE 1 LINES 
(GAME_ID,SEASON_ID,TEAM_ID_HOME,TEAM_ABBREVIATION_HOME,TEAM_NAME_HOME,@GAME_DATE,MATCHUP_HOME,WL_HOME,MIN_HOME,FGM_HOME,FGA_HOME,FG_PCT_HOME,FG3M_HOME,FG3A_HOME,
FG3_PCT_HOME,FTM_HOME,FTA_HOME,FT_PCT_HOME,OREB_HOME,DREB_HOME,REB_HOME,AST_HOME,STL_HOME,BLK_HOME,TOV_HOME,PF_HOME,PTS_HOME,PLUS_MINUS_HOME,VIDEO_AVAILABLE_HOME,
TEAM_ID_AWAY,TEAM_ABBREVIATION_AWAY,TEAM_NAME_AWAY,MATCHUP_AWAY,WL_AWAY,MIN_AWAY,FGM_AWAY,FGA_AWAY,FG_PCT_AWAY,FG3M_AWAY,FG3A_AWAY,FG3_PCT_AWAY,FTM_AWAY,
FTA_AWAY,FT_PCT_AWAY,OREB_AWAY,DREB_AWAY,REB_AWAY,AST_AWAY,STL_AWAY,BLK_AWAY,TOV_AWAY,PF_AWAY,PTS_AWAY,PLUS_MINUS_AWAY,VIDEO_AVAILABLE_AWAY,GAME_SEQUENCE,
GAME_STATUS_ID,GAME_STATUS_TEXT,GAMECODE,HOME_TEAM_ID,VISITOR_TEAM_ID,SEASON,LIVE_PERIOD,LIVE_PC_TIME,NATL_TV_BROADCASTER_ABBREVIATION,LIVE_PERIOD_TIME_BCAST,
WH_STATUS,TEAM_CITY_HOME,PTS_PAINT_HOME,PTS_2ND_CHANCE_HOME,PTS_FB_HOME,LARGEST_LEAD_HOME,LEAD_CHANGES_HOME,TIMES_TIED_HOME,TEAM_TURNOVERS_HOME,TOTAL_TURNOVERS_HOME,
@TEAM_REBOUNDS_HOME,@PTS_OFF_TO_HOME,TEAM_CITY_AWAY,PTS_PAINT_AWAY,PTS_2ND_CHANCE_AWAY,PTS_FB_AWAY,LARGEST_LEAD_AWAY,LEAD_CHANGES_AWAY,TIMES_TIED_AWAY,
TEAM_TURNOVERS_AWAY,TOTAL_TURNOVERS_AWAY,@TEAM_REBOUNDS_AWAY,@PTS_OFF_TO_AWAY,LEAGUE_ID,GAME_DATE_DAY,@ATTENDANCE,GAME_TIME,TEAM_CITY_NAME_HOME,TEAM_NICKNAME_HOME,
TEAM_WINS_LOSSES_HOME,PTS_QTR1_HOME,PTS_QTR2_HOME,PTS_QTR3_HOME,PTS_QTR4_HOME,PTS_OT1_HOME,PTS_OT2_HOME,PTS_OT3_HOME,PTS_OT4_HOME,@PTS_OT5_HOME,@PTS_OT6_HOME,@PTS_OT7_HOME,
@PTS_OT8_HOME,@PTS_OT9_HOME,@PTS_OT10_HOME,PTS_HOME_y,TEAM_CITY_NAME_AWAY,TEAM_NICKNAME_AWAY,TEAM_WINS_LOSSES_AWAY,PTS_QTR1_AWAY,PTS_QTR2_AWAY,PTS_QTR3_AWAY,
PTS_QTR4_AWAY,PTS_OT1_AWAY,PTS_OT2_AWAY,PTS_OT3_AWAY,PTS_OT4_AWAY,@PTS_OT5_AWAY,@PTS_OT6_AWAY,@PTS_OT7_AWAY,@PTS_OT8_AWAY,@PTS_OT9_AWAY,@PTS_OT10_AWAY,LAST_GAME_ID,
@LAST_GAME_DATE_EST,LAST_GAME_HOME_TEAM_ID,LAST_GAME_HOME_TEAM_CITY,LAST_GAME_HOME_TEAM_NAME,LAST_GAME_HOME_TEAM_ABBREVIATION,LAST_GAME_HOME_TEAM_POINTS,
LAST_GAME_VISITOR_TEAM_ID,LAST_GAME_VISITOR_TEAM_CITY,LAST_GAME_VISITOR_TEAM_NAME,LAST_GAME_VISITOR_TEAM_CITY1,LAST_GAME_VISITOR_TEAM_POINTS,HOME_TEAM_WINS,
HOME_TEAM_LOSSES,SERIES_LEADER,VIDEO_AVAILABLE_FLAG,PT_AVAILABLE,PT_XYZ_AVAILABLE,HUSTLE_STATUS,HISTORICAL_STATUS)

-- Convert input date fields to proper format
-- If any input cell defined as INT or REAL is empty, replace with NULL. Else, keep original value 	
SET 
	GAME_DATE = STR_TO_DATE(@GAME_DATE, '%m/%d/%Y'),
    LAST_GAME_DATE_EST = STR_TO_DATE(@LAST_GAME_DATE_EST, '%m/%d/%Y'),
    PTS_OT5_HOME = NULLIF(@PTS_OT5_HOME, ''),
    PTS_OT6_HOME = NULLIF(@PTS_OT6_HOME, ''),
    PTS_OT7_HOME = NULLIF(@PTS_OT7_HOME, ''),
	PTS_OT8_HOME = NULLIF(@PTS_OT8_HOME, ''),
    PTS_OT9_HOME = NULLIF(@PTS_OT9_HOME, ''),
    PTS_OT10_HOME = NULLIF(@PTS_OT10_HOME, ''),
	PTS_OT5_AWAY = NULLIF(@PTS_OT5_AWAY, ''),
    PTS_OT6_AWAY = NULLIF(@PTS_OT6_AWAY, ''),
    PTS_OT7_AWAY = NULLIF(@PTS_OT7_AWAY, ''),
    PTS_OT8_AWAY = NULLIF(@PTS_OT8_AWAY, ''),
    PTS_OT9_AWAY = NULLIF(@PTS_OT9_AWAY, ''),
    PTS_OT10_AWAY = NULLIF(@PTS_OT10_AWAY, ''), 
    TEAM_REBOUNDS_HOME = NULLIF(@TEAM_REBOUNDS_HOME, ''),
    TEAM_REBOUNDS_AWAY = NULLIF(@TEAM_REBOUNDS_AWAY, ''), 
    PTS_OFF_TO_HOME = NULLIF(@PTS_OFF_TO_HOME, ''), 
    PTS_OFF_TO_AWAY = NULLIF(@PTS_OFF_TO_AWAY, ''), 
    ATTENDANCE = NULLIF(@ATTENDANCE, '');
    
    
-- Check records to ensure all data was properly loaded  
SELECT*
FROM Playoffs_Data;


